<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="description" content="Compare the cost per mile between electric and gas vehicles. Calculate savings, visualize price relationships, and make informed decisions about your vehicle choice." />
  <title>Cost Per Mile</title>

  <!-- PWA Meta Tags -->
  <meta name="application-name" content="Cost Per Mile">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="CostPerMile">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-TileColor" content="#0f172a">
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="theme-color" content="#0f172a">
  <!-- Web App Manifest -->
  <link rel="manifest" href="/manifest.json" />
  <!-- Viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Icons -->
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
  <!-- Android Chrome Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/assets/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/assets/android-chrome-512x512.png">

  <!-- Tailwind CSS -->
  <link rel="stylesheet" href="main.css">

  <!-- Custom Styles -->
  <style>
    @keyframes pulse-blue {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .animate-pulse-blue {
      animation: pulse-blue 2s ease-in-out infinite;
    }
  </style>

  <!-- Alpine Plugins -->
  <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/mask@3.x.x/dist/cdn.min.js"></script>
  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Chart.js Annotation Plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
</head>
<body class="min-h-screen flex flex-col items-center gap-2 md:gap-6 px-2 pt-0 pb-2 bg-gray-100 dark:bg-slate-900" x-data="app" @click.capture="if (!$event.target.matches('input, button')) document.activeElement?.blur()">
  <!-- Header Section -->
  <header class="flex w-full max-w-4xl justify-between items-center bg-white dark:bg-slate-800 rounded-xl p-4 md:p-6 mt-2 md:mt-6 shadow-md" role="banner">
    <!-- Left section: Title and Debug -->
    <div class="flex items-center gap-2">
      <h1 class="text-md md:text-xl font-bold text-gray-800 dark:text-gray-200">Trip Cost Calculator</h1>
      <!-- Install Button -->
      <button
        x-show="!isStandalone && !isSafari"
        @click="installApp"
        x-ref="installButton"
        class="px-2 py-1.5 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors flex items-center gap-2">
          <span class="text-lg">ðŸ“±</span>
          <span>Install App</span>
      </button>
    </div>
    <!-- Right section: Share buttons -->
    <div class="flex items-center gap-2">
      <!-- Share Button -->
      <button
        @click="share"
        x-ref="shareButton"
        aria-label="Share calculator"
        class="px-3 py-1.5 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-slate-700 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors">
        Share
      </button>
    </div>
  </header>

  <!-- Results Section -->
  <section aria-label="Cost Results" class="w-full max-w-4xl sticky top-0 z-50">
    <div class="bg-white dark:bg-slate-800 rounded-xl p-4 md:p-6 shadow-md">
      <div class="flex flex-col md:flex-row md:space-x-8 space-y-4 md:space-y-0">
        <div class="flex flex-row flex-1">
          <!-- EV Result -->
          <div class="flex flex-col flex-1" role="region" aria-label="Electric Vehicle Cost">
            <div x-text="evResult.trip" class="text-lg font-bold text-green-700 dark:text-green-300"></div>
            <div x-text="evResult.perMile" class="text-sm text-green-700 dark:text-green-300"></div>
          </div>
          <!-- Gas Result -->
          <div class="flex flex-col flex-1" role="region" aria-label="Gas Vehicle Cost">
            <div x-text="gasResult.trip" class="text-lg font-bold text-rose-700 dark:text-rose-300"></div>
            <div x-text="gasResult.perMile" class="text-sm text-rose-700 dark:text-rose-300"></div>
          </div>
        </div>
        <!-- Savings Result -->
        <div class="flex flex-col flex-1 pt-2 md:pt-0 border-t md:border-t-0 md:border-l border-gray-200 dark:border-gray-700 md:pl-8" role="region" aria-label="Cost Savings">
          <div x-text="savingsResult.trip" class="text-lg font-bold text-blue-700 dark:text-blue-300"></div>
          <div x-text="savingsResult.perMile" class="text-sm text-blue-700 dark:text-blue-300"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Chart Section -->
  <section aria-label="Cost Comparison Chart" class="w-full max-w-4xl">
    <div class="bg-white dark:bg-slate-800 rounded-xl p-2 md:p-6 shadow-md">
      <div class="aspect-[16/9] md:aspect-[4/3] w-full">
        <canvas id="costChart" role="img" aria-label="Graph comparing electric and gas costs per mile"></canvas>
      </div>
    </div>
  </section>

  <!-- Inputs Section -->
  <main class="w-full max-w-4xl">
    <div class="bg-white dark:bg-slate-800 rounded-xl p-4 md:p-6 shadow-md">
      <form class="flex flex-col gap-6 max-w-4xl mx-auto" @submit.prevent>
        <div class="flex flex-col md:flex-row md:gap-12 md:justify-center">
          <!-- EV Input Section -->
          <fieldset class="flex-1 max-w-sm md:mb-0">
            <legend class="flex items-center mb-4">
              <span class="text-2xl mr-2" role="img" aria-label="Electric vehicle">ðŸ”‹</span>
              <h2 class="text-lg font-semibold text-green-700 dark:text-green-300">Electric</h2>
            </legend>
            <!-- EV Price Input -->
            <div class="grid grid-cols-2 gap-4">
              <div class="w-full">
                <label class="block">
                  <span class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" id="ev-price-label">Price</span>
                  <div class="relative">
                    <input
                      x-model="electricPrice"
                      x-mask:dynamic="$money($input, '.', ',', 4)"
                      @focus="focusedField = 'electric'"
                      @blur="focusedField = null"
                      type="text"
                      id="ev-price"
                      aria-labelledby="ev-price-label"
                      class="w-full px-3 py-2 pr-16 text-base rounded-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-slate-700
                      border border-blue-700/50 dark:border-blue-300/50
                      hover:border-blue-700 dark:hover:border-blue-300
                      focus:border-blue-700 dark:focus:border-blue-300 focus:ring-1 focus:ring-blue-700 dark:focus:ring-blue-300
                      outline-none transition-colors" />
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                      <span class="text-gray-700 dark:text-gray-300" aria-hidden="true">$/kWh</span>
                    </div>
                  </div>
                </label>
              </div>

              <!-- EV Efficiency Input -->
              <div class="w-full">
                <label class="block">
                  <span class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" id="ev-efficiency-label">Efficiency</span>
                  <div class="relative">
                    <input type="number"
                      x-model="evEfficiencyDisplay"
                      step="0.01"
                      id="ev-efficiency"
                      aria-labelledby="ev-efficiency-label"
                      class="w-full px-3 py-2 pr-16 text-base rounded-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-slate-700
                      border border-blue-700/50 dark:border-blue-300/50
                      focus:border-blue-700 dark:focus:border-blue-300 focus:ring-1 focus:ring-blue-700 dark:focus:ring-blue-300
                      outline-none transition-colors" />
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                      <template x-if="!isMiPerKwh">
                        <span class="text-gray-700 dark:text-gray-300" aria-hidden="true">Wh/mi</span>
                      </template>
                      <template x-if="isMiPerKwh">
                        <span class="text-gray-700 dark:text-gray-300" aria-hidden="true">mi/kWh</span>
                      </template>
                    </div>
                  </div>
                  <div class="flex justify-end mt-2">
                    <div class="inline-flex rounded-lg p-0.5 bg-gray-100 dark:bg-slate-700" role="radiogroup" aria-label="Efficiency unit">
                      <button
                        @click="isMiPerKwh = false"
                        :class="{'bg-white dark:bg-slate-600 shadow-md text-green-700 dark:text-green-300': !isMiPerKwh, 'text-gray-700 dark:text-gray-300': isMiPerKwh}"
                        class="px-3 py-1 text-sm rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50"
                        role="radio"
                        :aria-checked="!isMiPerKwh"
                        aria-label="Watt-hours per mile">
                        Wh/mi
                      </button>
                      <button
                        @click="isMiPerKwh = true"
                        :class="{'bg-white dark:bg-slate-600 shadow-md text-green-700 dark:text-green-300': isMiPerKwh, 'text-gray-700 dark:text-gray-300': !isMiPerKwh}"
                        class="px-3 py-1 text-sm rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50"
                        role="radio"
                        :aria-checked="isMiPerKwh"
                        aria-label="Miles per kilowatt-hour">
                        mi/kWh
                      </button>
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </fieldset>

          <!-- Divider -->
          <hr class="border-gray-200 dark:border-gray-700 my-6 lg:hidden">
          <!-- Vertical Divider for Desktop -->
          <div class="hidden lg:block border-l border-gray-200 dark:border-gray-700"></div>

          <!-- Gas Input Section -->
          <fieldset class="flex-1 max-w-sm">
            <legend class="flex items-center mb-4">
              <span class="text-2xl mr-2" role="img" aria-label="Gas vehicle">â›½</span>
              <h2 class="text-lg font-semibold text-rose-700 dark:text-rose-300">Gasoline</h2>
            </legend>
            <!-- Gas Price Input -->
            <div class="grid grid-cols-2 gap-4">
              <div class="w-full">
                <label class="block">
                  <span class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" id="gas-price-label">Price</span>
                  <div class="relative">
                    <input
                      x-model="gasPrice"
                      x-mask:dynamic="$money($input, '.', ',', 4)"
                      @focus="focusedField = 'gas'"
                      @blur="focusedField = null"
                      type="text"
                      id="gas-price"
                      aria-labelledby="gas-price-label"
                      class="w-full px-3 py-2 pr-16 text-base rounded-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-slate-700
                      border border-blue-700/50 dark:border-blue-300/50
                      hover:border-blue-700 dark:hover:border-blue-300
                      focus:border-blue-700 dark:focus:border-blue-300 focus:ring-1 focus:ring-blue-700 dark:focus:ring-blue-300
                      outline-none transition-colors" />
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                      <span class="text-gray-700 dark:text-gray-300" aria-hidden="true">$/gallon</span>
                    </div>
                  </div>
                </label>
              </div>

              <!-- Gas Efficiency Input -->
              <div class="w-full">
                <label class="block">
                  <span class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" id="gas-efficiency-label">Efficiency</span>
                  <div class="relative">
                    <input type="number"
                      x-model="mpg"
                      step="0.1"
                      id="gas-efficiency"
                      aria-labelledby="gas-efficiency-label"
                      class="w-full px-3 py-2 pr-12 text-base rounded-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-slate-700
                      border border-blue-700/50 dark:border-blue-300/50
                      hover:border-blue-700 dark:hover:border-blue-300
                      focus:border-blue-700 dark:focus:border-blue-300 focus:ring-1 focus:ring-blue-700 dark:focus:ring-blue-300
                      outline-none transition-colors" />
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                      <span class="text-gray-700 dark:text-gray-300" aria-hidden="true">mpg</span>
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </fieldset>
        </div>

        <hr class="border-gray-200 dark:border-gray-700">

        <!-- Trip Distance Section -->
        <fieldset class="flex flex-col md:flex-row md:gap-12">
          <div class="flex-1 max-w-sm">
            <legend class="flex items-center mb-4">
              <span class="text-2xl mr-2" role="img" aria-label="Distance">ðŸ§­</span>
              <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Trip Distance</h2>
            </legend>
            <div>
              <div class="w-full">
                <label class="block">
                  <div class="relative">
                    <input type="number"
                      x-model="miles"
                      step="1"
                      min="1"
                      id="trip-distance"
                      aria-label="Trip distance in miles"
                      class="w-full px-3 py-2 pr-8 text-base rounded-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-slate-700
                      border border-gray-200 dark:border-gray-700
                      hover:border-gray-300 dark:hover:border-gray-600
                      focus:border-gray-400 dark:focus:border-gray-500 focus:ring-1 focus:ring-gray-400 dark:focus:ring-gray-500
                      outline-none transition-colors" />
                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                      <span class="text-gray-700 dark:text-gray-300" aria-hidden="true">mi</span>
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <!-- Divider -->
          <hr class="border-gray-200 dark:border-gray-700 my-6 lg:hidden">
          <!-- Vertical Divider for Desktop -->
          <div class="hidden lg:block border-l border-gray-200 dark:border-gray-700"></div>

          <!-- Sync Button -->
          <div class="flex-1 max-w-sm">
            <div class="flex items-center mb-4">
              <span class="text-2xl mr-2">ðŸ”—</span>
              <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Price Sync</h2>
            </div>
            <div>
              <button @click="toggleSync" class="w-full px-3 py-2 text-base rounded-lg text-gray-800 dark:text-gray-200 bg-white dark:bg-slate-700
                border border-gray-200 dark:border-gray-700
                hover:border-gray-300 dark:hover:border-gray-600
                focus:border-gray-400 dark:focus:border-gray-500 focus:ring-1 focus:ring-gray-400 dark:focus:ring-gray-500
                outline-none transition-colors flex items-center justify-center gap-2"
                :class="syncPrices ? 'border-blue-500 dark:border-blue-400 hover:border-blue-600 dark:hover:border-blue-300' : ''">
                <span x-text="syncPrices ? 'ðŸ”„' : 'ðŸ”—'" class="text-lg"></span>
                <span x-text="syncPrices ? 'Syncing Prices' : 'Sync Prices'"
                      :class="syncPrices ? 'text-blue-700 dark:text-blue-300 animate-pulse-blue' : 'text-gray-700 dark:text-gray-300'"
                      class="text-sm font-bold transition-colors"></span>
              </button>
            </div>
          </div>
        </fieldset>
      </form>

      <!-- Divider -->
      <hr class="border-gray-200 dark:border-gray-700 my-10">

      <!-- Vehicle Presets Section -->
      <div class="">
        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4">Vehicles</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- EV Presets -->
          <div class="space-y-3">
            <div class="flex flex-wrap gap-3">
              <template x-for="vehicle in vehiclePresets.ev" :key="vehicle.name">
                <button
                  @click="evWhPerMile = vehicle.efficiency; isMiPerKwh = vehicle.isMiPerKwh"
                  class="group relative px-4 py-2.5 text-sm font-medium text-green-700 dark:text-green-300 bg-green-50 dark:bg-green-900/30 rounded-xl hover:bg-green-100 dark:hover:bg-green-900/50 transition-all duration-200 hover:shadow-md border-2 border-transparent hover:border-green-500">
                  <div class="flex items-center gap-2">
                    <span class="text-lg">ðŸš—</span>
                    <span x-text="vehicle.name"></span>
                  </div>
                </button>
              </template>
            </div>
          </div>
          <!-- Gas Presets -->
          <div class="space-y-3">
            <div class="flex flex-wrap gap-3">
              <template x-for="vehicle in vehiclePresets.gas" :key="vehicle.name">
                <button
                  @click="mpg = vehicle.efficiency"
                  class="group relative px-4 py-2.5 text-sm font-medium text-rose-700 dark:text-rose-300 bg-rose-50 dark:bg-rose-900/30 rounded-xl hover:bg-rose-100 dark:hover:bg-rose-900/50 transition-all duration-200 hover:shadow-md border-2 border-transparent hover:border-rose-500">
                  <div class="flex items-center gap-2">
                    <span class="text-lg">ðŸš™</span>
                    <span x-text="vehicle.name"></span>
                  </div>
                </button>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="relative z-0 inline-grid grid-cols-3 gap-0.5 rounded-full bg-gray-950/5 p-0.75 text-gray-950 dark:bg-white/10 dark:text-white">
    <button
      @click="theme = 'system'; updateTheme()"
      :class="{'bg-white dark:bg-gray-700 shadow-md': theme === 'system'}"
      class="rounded-full p-1.5 *:size-7 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"
      aria-label="System theme">
      <svg viewBox="0 0 28 28" fill="none"><path d="M7.5 8.5C7.5 7.94772 7.94772 7.5 8.5 7.5H19.5C20.0523 7.5 20.5 7.94772 20.5 8.5V16.5C20.5 17.0523 20.0523 17.5 19.5 17.5H8.5C7.94772 17.5 7.5 17.0523 7.5 16.5V8.5Z" stroke="currentColor"></path><path d="M7.5 8.5C7.5 7.94772 7.94772 7.5 8.5 7.5H19.5C20.0523 7.5 20.5 7.94772 20.5 8.5V14.5C20.5 15.0523 20.0523 15.5 19.5 15.5H8.5C7.94772 15.5 7.5 15.0523 7.5 14.5V8.5Z" stroke="currentColor"></path><path d="M16.5 20.5V17.5H11.5V20.5M16.5 20.5H11.5M16.5 20.5H17.5M11.5 20.5H10.5" stroke="currentColor" stroke-linecap="round"></path></svg>
    </button>
    <button
      @click="theme = 'light'; updateTheme()"
      :class="{'bg-white dark:bg-gray-700 shadow-md': theme === 'light'}"
      class="rounded-full p-1.5 *:size-7 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"
      aria-label="Light theme">
      <svg viewBox="0 0 28 28" fill="none"><circle cx="14" cy="14" r="3.5" stroke="currentColor"></circle><path d="M14 8.5V6.5" stroke="currentColor" stroke-linecap="round"></path><path d="M17.889 10.1115L19.3032 8.69727" stroke="currentColor" stroke-linecap="round"></path><path d="M19.5 14L21.5 14" stroke="currentColor" stroke-linecap="round"></path><path d="M17.889 17.8885L19.3032 19.3027" stroke="currentColor" stroke-linecap="round"></path><path d="M14 21.5V19.5" stroke="currentColor" stroke-linecap="round"></path><path d="M8.69663 19.3029L10.1108 17.8887" stroke="currentColor" stroke-linecap="round"></path><path d="M6.5 14L8.5 14" stroke="currentColor" stroke-linecap="round"></path><path d="M8.69663 8.69711L10.1108 10.1113" stroke="currentColor" stroke-linecap="round"></path></svg>
    </button>
    <button
      @click="theme = 'dark'; updateTheme()"
      :class="{'bg-white dark:bg-gray-700 shadow-md': theme === 'dark'}"
      class="rounded-full p-1.5 *:size-7 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors"
      aria-label="Dark theme">
      <svg viewBox="0 0 28 28" fill="none"><path d="M10.5 9.99914C10.5 14.1413 13.8579 17.4991 18 17.4991C19.0332 17.4991 20.0176 17.2902 20.9132 16.9123C19.7761 19.6075 17.109 21.4991 14 21.4991C9.85786 21.4991 6.5 18.1413 6.5 13.9991C6.5 10.8902 8.39167 8.22304 11.0868 7.08594C10.7089 7.98159 10.5 8.96597 10.5 9.99914Z" stroke="currentColor" stroke-linejoin="round"></path><path d="M16.3561 6.50754L16.5 5.5L16.6439 6.50754C16.7068 6.94752 17.0525 7.29321 17.4925 7.35607L18.5 7.5L17.4925 7.64393C17.0525 7.70679 16.7068 8.05248 16.6439 8.49246L16.5 9.5L16.3561 8.49246C16.2932 8.05248 15.9475 7.70679 15.5075 7.64393L14.5 7.5L15.5075 7.35607C15.9475 7.29321 16.2932 6.94752 16.3561 6.50754Z" fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M20.3561 11.5075L20.5 10.5L20.6439 11.5075C20.7068 11.9475 21.0525 12.2932 21.4925 12.3561L22.5 12.5L21.4925 12.6439C21.0525 12.7068 20.6439 13.4925 20.5 14.5L20.3561 13.4925C20.2932 13.0525 19.9475 12.7068 19.5075 12.6439L18.5 12.5L19.5075 12.3561C19.9475 12.2932 20.2932 11.9475 20.3561 11.5075Z" fill="currentColor" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></svg>
    </button>
  </div>


  <!-- About Section -->
  <div class="w-full max-w-4xl flex flex-col gap-10 mb-10">
    <!-- How to Use Section -->
    <section class="text-gray-700 dark:text-gray-300 text-sm">
      <h2 class="text-lg font-semibold mb-2">How to Use the Trip Cost Calculator</h2>
      <p class="mb-4">
        Quickly compare the cost per mile between an electric vehicle (EV) and a gas-powered car. This guide walks you through each feature so you can get accurate insights in just a few steps.
      </p>
      <ul class="list-disc pl-6 space-y-4">
        <li>
          <strong>Enter Energy & Fuel Prices:</strong> Input your local electricity rate ($/kWh) and gas price ($/gallon). This ensures the calculator uses up-to-date energy costs for your area.
        </li>
        <li>
          <strong>Set Vehicle Efficiency:</strong> For EVs, enter efficiency in Wh/mi or mi/kWh (switch easily between units). For gas cars, input miles per gallon (MPG).
        </li>
        <li>
          <strong>Choose Trip Distance:</strong> Specify the number of miles for your trip. The calculator estimates total trip cost and cost per mile for both vehicle types.
        </li>
        <li>
          <strong>Review Cost Comparisons:</strong> Instantly see cost per mile and total trip cost for both your EV and gas car. Savings are clearly displayed, so you know which option costs less.
        </li>
        <li>
          <strong>View Interactive Chart:</strong> The graph below compares electricity and gas prices across cost per mile points, helping you visualize savings at a glance.
        </li>
        <li>
          <strong>Use Vehicle Presets:</strong> Quickly load efficiency values for popular electric and gas vehicles with one click.
        </li>
        <li>
          <strong>Share or Install the App:</strong> Easily share your customized comparison or install the app as a Progressive Web App (PWA) for offline access.
        </li>
      </ul>
      <p class="mt-6">
        Whether you're evaluating a switch to electric or planning a trip, this tool helps you make informed decisions with real-time calculations and visual insights.
      </p>
    </section>
    <!-- About Section -->
    <section class="text-gray-700 dark:text-gray-300 text-sm">
      <h2 class="text-lg font-semibold mb-2">Make Smarter Driving Decisions: Compare Electric Vehicles to Gas Cars</h2>
      <p>
        Curious about how much it costs to drive your electric vehicle compared to a gas-powered one? Our trip cost calculator makes it easy. Enter your electricity rate, gas price, vehicle efficiency, and trip distance to calculate the cost per mile for both electric and gas cars. Whether you're commuting daily or planning a road trip, this tool helps you see where your money goes.
      </p>
      <h3 class="text-md font-semibold mt-4 mb-2">Calculate Trip Costs and Savings</h3>
      <p>
        With this cost per mile estimator, you can quickly calculate the cost of any trip. Simply input your EV's efficiency in Wh/mi or mi/kWh, and compare it to a gas car's MPG. The calculator shows both total trip cost and cost per mile, so you can clearly see the difference in fuel expenses between electric and gas vehicles. It's the perfect tool for planning your next journey or evaluating long-term savings.
      </p>
      <h3 class="text-md font-semibold mt-4 mb-2">Built-in Conversions: MPG to kWh, Wh/mi to mi/kWh</h3>
      <p>
        Not sure how to compare efficiency across different vehicle types? No problem. Our calculator includes built-in conversions like MPG to kWh and Wh/mi to mi/kWh, so you can easily line up your gas car and EV side by side. This way, you can compare apples to apples and make informed decisions about your driving costs.
      </p>
      <h3 class="text-md font-semibold mt-4 mb-2">Why Use This Calculator?</h3>
      <p>
        Whether you're evaluating the cost of switching to electric or just curious about your vehicle's efficiency, this tool is designed to help. Get accurate insights into fuel costs, optimize your driving budget, and see how much you could save by going electric. Try it now and take control of your trip expenses.
      </p>
    </section>
  </div>

  <!-- Footer Section -->
  <footer class="w-full max-w-4xl flex justify-between items-center mb-10" role="contentinfo">
    <div class="text-sm text-gray-700 dark:text-gray-300">
      Â© <span x-text="new Date().getFullYear()"></span> Cost Per Mile Calculator
    </div>
  </footer>

  <script>
    const stateDefaults = {
      theme: {
        defaultValue: 'system',
        storageKey: 'theme'
      },
      electricPrice: {
        defaultValue: 0.25,
        storageKey: 'electricPrice'
      },
      gasPrice: {
        defaultValue: 2.83,
        storageKey: 'gasPrice'
      },
      evWhPerMile: {
        defaultValue: 250,
        storageKey: 'evWhPerMile'
      },
      isMiPerKwh: {
        defaultValue: false,
        storageKey: 'isMiPerKwh'
      },
      mpg: {
        defaultValue: 28,
        storageKey: 'mpg'
      },
      miles: {
        defaultValue: 10,
        storageKey: 'miles'
      },
      syncPrices: {
        defaultValue: false,
        storageKey: 'syncPrices'
      }
    };

    // Vehicle Presets
    const vehiclePresets = {
      ev: [
        {
          name: 'Tesla Model Y',
          efficiency: 250, // Wh/mi
          isMiPerKwh: false
        },
        {
          name: 'Hyundai IONIQ 6',
          efficiency: 240, // Wh/mi
          isMiPerKwh: false
        }
      ],
      gas: [
        {
          name: 'Honda CR-V',
          efficiency: 30, // mpg
          isMiPerKwh: false
        },
        {
          name: 'Subaru Forester',
          efficiency: 28, // mpg
          isMiPerKwh: false
        }
      ]
    };

    // Helpers

    class Utils {
      static formatPrice(price, decimals = 2) {
        if (!price) return '-';
        return `$${parseFloat(price).toFixed(decimals)}`;
      }

      static formatPricePerMile(pricePerMile, decimals = 4) {
        if (!pricePerMile) return '-';
        return `$${parseFloat(pricePerMile).toFixed(decimals)}/mi`;
      }

      static evCostPerMile(whPerMile, electricPrice) {
        return (whPerMile / 1000) * electricPrice;
      }

      static gasCostPerMile(mpg, gasPrice) {
        return gasPrice / mpg;
      }

      static equivalentEvPrice(gasCostPerMile, whPerMile) {
        return (gasCostPerMile * 1000) / whPerMile;
      }

      static equivalentGasPrice(evCostPerMile, mpg) {
        return evCostPerMile * mpg;
      }
    }
  </script>

  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.data('app', () => ({
        theme: localStorage.getItem(stateDefaults.theme.storageKey) || stateDefaults.theme.defaultValue,
        electricPrice: parseFloat(localStorage.getItem(stateDefaults.electricPrice.storageKey)) || stateDefaults.electricPrice.defaultValue,
        gasPrice: parseFloat(localStorage.getItem(stateDefaults.gasPrice.storageKey)) || stateDefaults.gasPrice.defaultValue,
        evWhPerMile: parseFloat(localStorage.getItem(stateDefaults.evWhPerMile.storageKey)) || stateDefaults.evWhPerMile.defaultValue,
        isMiPerKwh: localStorage.getItem(stateDefaults.isMiPerKwh.storageKey) === 'true' || stateDefaults.isMiPerKwh.defaultValue,
        mpg: parseFloat(localStorage.getItem(stateDefaults.mpg.storageKey)) || stateDefaults.mpg.defaultValue,
        miles: parseFloat(localStorage.getItem(stateDefaults.miles.storageKey)) || stateDefaults.miles.defaultValue,
        syncPrices: localStorage.getItem(stateDefaults.syncPrices.storageKey) === 'true' || stateDefaults.syncPrices.defaultValue,
        focusedField: null,
        chart: null,
        deferredPrompt: null,
        isStandalone: window.matchMedia('(display-mode: standalone)').matches,
        isSafari: /^((?!chrome|android).)*safari/i.test(navigator.userAgent),

        init() {
          this.initializeStateFromUrl();
          this.updateTheme();
          this.setupWatchers();
          this.$nextTick(() => {
            this.renderChart();
          });
          this.registerPwaPrompt();
        },

        get darkMode() {
          return this.theme === 'dark' || (this.theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
        },

        get evEfficiencyDisplay() {
          return this.isMiPerKwh ? parseFloat((1000 / this.evWhPerMile).toFixed(2)) : parseFloat(this.evWhPerMile.toFixed(2));
        },
        set evEfficiencyDisplay(val) {
          const parsed = parseFloat(val);
          if (!parsed || parsed <= 0) return;
          this.evWhPerMile = this.isMiPerKwh ? parseFloat((1000 / parsed).toFixed(2)) : parseFloat(parsed.toFixed(2));
        },

        get evCostPerMile() {
          if (!this.evWhPerMile || !this.electricPrice) return '';
          return Utils.evCostPerMile(this.evWhPerMile, this.electricPrice);
        },

        get gasCostPerMile() {
          if (!this.mpg || !this.gasPrice) return '';
          return Utils.gasCostPerMile(this.mpg, this.gasPrice);
        },

        get equivalentEvPrice() {
          if (!this.gasCostPerMile || !this.evWhPerMile) return '';
          return Utils.equivalentEvPrice(this.gasCostPerMile, this.evWhPerMile);
        },

        get equivalentGasPrice() {
          if (!this.evCostPerMile || !this.mpg) return '';
          return Utils.equivalentGasPrice(this.evCostPerMile, this.mpg);
        },

        get evResult() {
          if (!this.evCostPerMile) return { trip: 'EV Trip: -', perMile: '-' };
          const tripCost = this.evCostPerMile * this.miles;

          return {
            trip: `EV Trip: ${Utils.formatPrice(tripCost)}`,
            perMile: `${Utils.formatPricePerMile(this.evCostPerMile)}`
          };
        },

        get gasResult() {
          if (!this.gasCostPerMile) return { trip: 'Gas Trip: -', perMile: '-' };
          const tripCost = this.gasCostPerMile * this.miles;

          return {
            trip: `Gas Trip: ${Utils.formatPrice(tripCost)}`,
            perMile: `${Utils.formatPricePerMile(this.gasCostPerMile)}`
          };
        },

        get savingsResult() {
          if (!this.evCostPerMile || !this.gasCostPerMile) return { trip: '-', perMile: '-' };

          if (this.syncPrices) {
            return {
              trip: `Syncing prices`,
              perMile: `-`
            }
          }

          const ev = this.evCostPerMile;
          const gas = this.gasCostPerMile;

          const savingsPerMile = gas - ev;
          const totalSavings = savingsPerMile * this.miles;
          const percentDiff = Math.abs(savingsPerMile) / Math.max(ev, gas) * 100;
          const whoSaves = savingsPerMile > 0 ? 'EV' : 'Gas';

          if (totalSavings === 0) {
            return {
              trip: `No Savings`,
              perMile: `-`
            };
          }

          return {
            trip: `${whoSaves} saves: ${Utils.formatPrice(Math.abs(totalSavings))} (${percentDiff.toFixed(2)}%)`,
            perMile: `${Utils.formatPricePerMile(Math.abs(savingsPerMile))}`
          };
        },

        chartColors() {
          const getColor = (varName) => getComputedStyle(document.documentElement).getPropertyValue(varName).trim();
          const darkMode = this.darkMode;

          return {
            equivalentPrice: {
              background: darkMode ? getColor('--color-blue-300') : getColor('--color-blue-700'),
              border: darkMode ? getColor('--color-blue-300') : getColor('--color-blue-700'),
              text: darkMode ? getColor('--color-blue-300') : getColor('--color-blue-700'),
            },
            electricity: {
              background: darkMode ? getColor('--color-green-700') : getColor('--color-green-700'),
              border: darkMode ? getColor('--color-green-300') : getColor('--color-green-700'),
              text: darkMode ? getColor('--color-green-300') : getColor('--color-green-700'),
            },
            gas: {
              background: darkMode ? getColor('--color-rose-700') : getColor('--color-rose-300'),
              border: darkMode ? getColor('--color-rose-300') : getColor('--color-rose-700'),
              text: darkMode ? getColor('--color-rose-300') : getColor('--color-rose-700'),
            },
            title: {
              text: darkMode ? getColor('--color-gray-400') : getColor('--color-gray-600'),
            },
            grid: {
              line: darkMode ? getColor('--color-gray-700') : getColor('--color-gray-200'),
            },
          };
        },

        generateChartData() {
          const costPerMilePoints = [];
          const evPrices = [];
          const gasPrices = [];

          // Generate cost per mile points from $0.00 to $0.25 in $0.001 increments
          for (let costPerMile = 0; costPerMile <= 0.25; costPerMile += 0.001) {
            const roundedCostPerMile = parseFloat(costPerMile.toFixed(4));
            costPerMilePoints.push(roundedCostPerMile);

            // Calculate equivalent electricity price for this cost per mile
            const evPrice = Utils.equivalentEvPrice(roundedCostPerMile, this.evWhPerMile);
            evPrices.push(evPrice);

            // Calculate equivalent gas price for this cost per mile
            const gasPrice = Utils.equivalentGasPrice(roundedCostPerMile, this.mpg);
            gasPrices.push(gasPrice);
          }

          return {
            costsPerMile: costPerMilePoints,
            evPrices: evPrices,
            gasPrices: gasPrices,
            // chart.js multiplies values by 1000 internally to avoid floating point precision issues
            // to match the values in the chart, we need to multiply by 1000
            evCostPerMile: parseFloat((this.evCostPerMile * 1000).toFixed(4)),
            gasCostPerMile: parseFloat((this.gasCostPerMile * 1000).toFixed(4)),
            electricPrice: this.electricPrice,
            gasPrice: this.gasPrice,
          };
        },

        renderChart() {
          const ctx = document.getElementById('costChart');
          if (!ctx) return;

          if (this.chart) {
            this.chart.destroy();
            this.chart = null;
          }

          const data = this.generateChartData();
          console.log('data.electricPrice', data.electricPrice);
          console.log('data.gasPrice', data.gasPrice);
          this.chart = new Chart(ctx, this.chartConfig(data));
        },

        chartConfig(data) {
          const colors = this.chartColors();

          return {
            type: 'line',
            data: {
              labels: data.costsPerMile,
              datasets: [
              {
                label: 'Electricity $/kWh',
                data: data.evPrices,
                borderColor: colors.equivalentPrice.border,
                backgroundColor: colors.equivalentPrice.background,
                borderWidth: 2,
                tension: 0.1,
                yAxisID: 'y'
              }
              ]
            },
            options: {
              interaction: {
                mode: 'index',
                axis: 'x',
                intersect: true,
              },
              responsive: true,
              maintainAspectRatio: false,
              animation: false,
              plugins: {
                title: {
                  display: true,
                  text: 'EV to Gas Prices',
                  color: colors.title.text,
                  font: {
                    size: 16
                  }
                },
                legend: {
                  display: false,
                },
                tooltip: {
                  displayColors: false,
                  backgroundColor: '#010101E6',
                  titleFont: {
                    size: 16,
                    weight: 'bold',
                  },
                  bodyFont: {
                    size: 14,
                    weight: 'bold',
                  },
                  padding: 10,
                  titleMarginBottom: 10,
                  footerMarginTop: 10,
                  callbacks: {
                    title: function(context) {
                      const pricePerMile = context[0].dataset.data[context[0].dataIndex];
                      return `Cost Per Mile: ${Utils.formatPricePerMile(pricePerMile)}`;
                    },
                    label: function(context) {
                      const label = context.dataset.label;
                      // todo: is there a more elegant way in chart.js to only show tooltips for one dataset?
                      const isElectric = label.includes('Electricity');
                      if (!isElectric) return '';

                      const evPrice = `${Utils.formatPrice(data.evPrices[context.dataIndex])}/kWh`;
                      const gasPrice = `${Utils.formatPrice(data.gasPrices[context.dataIndex])}/gal`;

                      const labels = [
                        `EV Cost:ðŸ”‹${evPrice}`,
                        `Equivalent Cost: â›½ï¸${gasPrice}`,
                      ];

                      return labels
                    }
                  }
                },
                annotation: {
                  annotations: {
                    evPriceLine: {
                      type: 'line',
                      yMin: data.electricPrice,
                      yMax: data.electricPrice,
                      borderColor: colors.electricity.border,
                      borderWidth: 2,
                      borderDash: [5, 5],
                      scaleID: 'y',
                      label: {
                        display: true,
                        content: [
                          `ðŸ”‹${Utils.formatPrice(data.electricPrice)}/kWh`,
                          `â›½ï¸${Utils.formatPrice(data.gasPrice)}/gal`,
                        ],
                        textAlign: 'start',
                        position: 'start',
                        backgroundColor: colors.electricity.background,
                        color: 'white',
                        font: {
                          size: 14
                        }
                      }
                    },
                    gasPriceLine: {
                      type: 'line',
                      yMin: data.gasPrice,
                      yMax: data.gasPrice,
                      borderColor: colors.gas.border,
                      borderWidth: 2,
                      borderDash: [5, 5],
                      scaleID: 'y1',
                      label: {
                        display: true,
                        content: [
                          `â›½ï¸${Utils.formatPrice(data.gasPrice)}/gal`,
                          `ðŸ”‹${Utils.formatPrice(data.electricPrice)}/kWh`,
                        ],
                        textAlign: 'start',
                        position: 'center',
                        backgroundColor: colors.gas.background,
                        color: 'white',
                        font: {
                          size: 14
                        }
                      }
                    },
                    evLine: {
                      type: 'line',
                      xMin: data.evCostPerMile,
                      xMax: data.evCostPerMile,
                      borderColor: colors.electricity.border,
                      borderWidth: 2,
                      borderDash: [5, 5],
                      label: {
                        display: true,
                        content: [
                          `ðŸ”‹${Utils.formatPrice(data.electricPrice)}/kWh`,
                          `â›½ï¸${Utils.formatPrice(data.gasPrice)}/gal`,
                        ],
                        textAlign: 'start',
                        position: 'start',
                        backgroundColor: colors.electricity.background,
                        color: 'white',
                        font: {
                          size: 14
                        }
                      }
                    },
                    gasLine: {
                      type: 'line',
                      xMin: data.gasCostPerMile,
                      xMax: data.gasCostPerMile,
                      borderColor: colors.gas.border,
                      borderWidth: 2,
                      borderDash: [5, 5],
                      label: {
                        display: true,
                        content: [
                          `â›½ï¸${Utils.formatPrice(data.gasPrice)}/gal`,
                          `ðŸ”‹${Utils.formatPrice(data.electricPrice)}/kWh`,
                        ],
                        textAlign: 'start',
                        position: 'center',
                        backgroundColor: colors.gas.background,
                        color: 'white',
                        font: {
                          size: 14
                        }
                      }
                    }
                  }
                }
              },
              scales: {
                x: {
                  title: {
                    display: true,
                    text: 'Cost per Mile ($)',
                    color: colors.title.text
                  },
                  ticks: {
                    callback: function(value, index, ticks) {
                      // chart.js multiplies values by 1000 internally to avoid floating point precision issues
                      return Utils.formatPricePerMile(value/1000);
                    },
                    color: colors.title.text,
                    font: {
                      size: 10
                    }
                  },
                  grid: {
                    color: colors.grid.line
                  }
                },
                y: {
                  type: 'linear',
                  display: true,
                  position: 'left',
                  title: {
                    display: true,
                    text: 'Electricity ($/kWh)',
                    color: colors.electricity.text
                  },
                  ticks: {
                    callback: function(value, index, ticks) {
                      return Utils.formatPrice(value);
                    },
                    color: colors.title.text,
                    font: {
                      size: 10
                    }
                  },
                  beginAtZero: true,
                  min: 0,
                  max: 1.0,
                  grid: {
                    color: colors.grid.line
                  }
                },
                y1: {
                  type: 'linear',
                  display: true,
                  position: 'right',
                  title: {
                    display: true,
                    text: 'Gas ($/gal)',
                    color: colors.gas.text
                  },
                  ticks: {
                    callback: function(value, index, ticks) {
                      return Utils.formatPrice(value);
                    },
                    color: colors.title.text,
                    font: {
                      size: 10
                    }
                  },
                  beginAtZero: true,
                  min: 0,
                  max: 8.0,
                  grid: {
                    drawOnChartArea: false
                  }
                }
              }
            }
          }
        },

        toggleSync() {
          this.syncPrices = !this.syncPrices;
          localStorage.setItem(stateDefaults.syncPrices.storageKey, this.syncPrices);
          this.updateURL();
        },

        updateLockedPrices() {
          if (!this.syncPrices) return;

          // Only update the unfocused field
          if (this.focusedField === 'electric' && this.equivalentGasPrice) {
            this.gasPrice = parseFloat(this.equivalentGasPrice);
          } else if (this.focusedField === 'gas' && this.equivalentEvPrice) {
            this.electricPrice = parseFloat(this.equivalentEvPrice);
          }
        },

        async share() {
          if (navigator.share) {
            try {
              await navigator.share({
                title: 'Cost Per Mile Comparison',
                url: window.location.href
              });
            } catch {
              // Fall back to clipboard if share is cancelled or fails
              this.copyToClipboard();
            }
          } else {
            this.copyToClipboard();
          }
        },

        async copyToClipboard() {
          await navigator.clipboard.writeText(window.location.href);
          this.$refs.shareButton.textContent = 'Copied!';
          setTimeout(() => this.$refs.shareButton.textContent = 'Share', 2000);
        },

        updateURL() {
          const params = new URLSearchParams();
          if (this.electricPrice) params.set(stateDefaults.electricPrice.storageKey, this.electricPrice);
          if (this.gasPrice) params.set(stateDefaults.gasPrice.storageKey, this.gasPrice);
          if (this.evWhPerMile) params.set(stateDefaults.evWhPerMile.storageKey, this.evWhPerMile);
          params.set(stateDefaults.isMiPerKwh.storageKey, this.isMiPerKwh);
          if (this.mpg) params.set(stateDefaults.mpg.storageKey, this.mpg);
          if (this.miles) params.set(stateDefaults.miles.storageKey, this.miles);
          params.set(stateDefaults.syncPrices.storageKey, this.syncPrices);

          // Update URL without reloading the page
          const newURL = `${window.location.pathname}?${params.toString()}`;
          window.history.replaceState({}, '', newURL);
        },

        updateTheme() {
          document.documentElement.classList.toggle('dark', this.darkMode);
          this.renderChart();
        },

        initializeStateFromUrl() {
          const params = new URLSearchParams(window.location.search);
          const urlValues = {
            electricPrice: parseFloat(params.get(stateDefaults.electricPrice.storageKey)) || null,
            gasPrice: parseFloat(params.get(stateDefaults.gasPrice.storageKey)) || null,
            evWhPerMile: parseFloat(params.get(stateDefaults.evWhPerMile.storageKey)) || null,
            isMiPerKwh: params.get(stateDefaults.isMiPerKwh.storageKey) === 'true',
            mpg: parseFloat(params.get(stateDefaults.mpg.storageKey)) || null,
            miles: parseFloat(params.get(stateDefaults.miles.storageKey)) || null,
            syncPrices: params.get(stateDefaults.syncPrices.storageKey) === 'true'
          };

          if (Object.values(urlValues).some(v => v !== null)) {
            if (urlValues.electricPrice !== null) {
              this.electricPrice = urlValues.electricPrice;
              localStorage.setItem(stateDefaults.electricPrice.storageKey, urlValues.electricPrice);
            }
            if (urlValues.gasPrice !== null) {
              this.gasPrice = parseFloat(urlValues.gasPrice);
              localStorage.setItem(stateDefaults.gasPrice.storageKey, urlValues.gasPrice);
            }
            if (urlValues.evWhPerMile !== null) {
              this.evWhPerMile = urlValues.evWhPerMile;
              localStorage.setItem(stateDefaults.evWhPerMile.storageKey, urlValues.evWhPerMile);
            }
            if (params.has(stateDefaults.isMiPerKwh.storageKey)) {
              this.isMiPerKwh = urlValues.isMiPerKwh;
              localStorage.setItem(stateDefaults.isMiPerKwh.storageKey, this.isMiPerKwh);
            }
            if (urlValues.mpg !== null) {
              this.mpg = urlValues.mpg;
              localStorage.setItem(stateDefaults.mpg.storageKey, urlValues.mpg);
            }
            if (urlValues.miles !== null) {
              this.miles = urlValues.miles;
              localStorage.setItem(stateDefaults.miles.storageKey, urlValues.miles);
            }
            if (params.has(stateDefaults.syncPrices.storageKey)) {
              this.syncPrices = urlValues.syncPrices;
              localStorage.setItem(stateDefaults.syncPrices.storageKey, this.syncPrices);
            }
          }

          // Update URL with initial values if no params were present
          if (!window.location.search) {
            this.updateURL();
          }
        },

        setupWatchers() {
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            if (this.theme === 'system') this.updateTheme();
          });

          // Watch for changes and update both localStorage and URL and locked prices
          this.$watch('electricPrice', value => {
            localStorage.setItem(stateDefaults.electricPrice.storageKey, value);
            this.updateURL();
            this.updateLockedPrices();
            this.renderChart();
          });
          this.$watch('gasPrice', value => {
            localStorage.setItem(stateDefaults.gasPrice.storageKey, value);
            this.updateURL();
            this.updateLockedPrices();
            this.renderChart();
          });
          this.$watch('mpg', value => {
            localStorage.setItem(stateDefaults.mpg.storageKey, value);
            this.updateURL();
            this.updateLockedPrices();
            this.renderChart();
          });
          this.$watch('evWhPerMile', value => {
            localStorage.setItem(stateDefaults.evWhPerMile.storageKey, value);
            this.updateURL();
            this.updateLockedPrices();
            this.renderChart();
          });
          this.$watch('isMiPerKwh', value => {
            localStorage.setItem(stateDefaults.isMiPerKwh.storageKey, this.isMiPerKwh);
            this.updateURL();
            this.updateLockedPrices();
            this.renderChart();
          });
          this.$watch('miles', value => {
            localStorage.setItem(stateDefaults.miles.storageKey, value);
            this.updateURL();
          });
          this.$watch('theme', value => {
            this.updateTheme();
            localStorage.setItem(stateDefaults.theme.storageKey, value);
          });
        },

        registerPwaPrompt() {
          window.addEventListener('beforeinstallprompt', (e) => {
            // Store the event for later use
            this.deferredPrompt = e;
            // Show the install button
            this.$refs.installButton?.classList.remove('hidden');
          });

          window.addEventListener('appinstalled', () => {
            this.isStandalone = true;
            this.deferredPrompt = null;
            // Hide the install button after installation
            this.$refs.installButton?.classList.add('hidden');
          });
        },

        async installApp() {
          if (!this.deferredPrompt) return;

          // Show the install prompt
          this.deferredPrompt.prompt();

          // Wait for the user to respond to the prompt
          const { outcome } = await this.deferredPrompt.userChoice;
          console.log(`User response to the install prompt: ${outcome}`);

          // Clear the deferredPrompt
          this.deferredPrompt = null;
        }
      }));
    });
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .catch(err => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
  </script>
</body>
</html>